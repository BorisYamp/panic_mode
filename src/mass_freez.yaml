# =============================================================================
# PanicMode: Mass Freeze Configuration
# =============================================================================
#
# Этот файл определяет КАК выполнять массовую заморозку процессов.
# Копируйте в /etc/panicmode/mass_freeze.yaml и адаптируйте.
#
# Связь с config.yaml:
#   mass_freeze            → заморозить ВСЁ кроме whitelist (этот файл)
#   mass_freeze_top        → заморозить top N по CPU (настройка ниже)
#   mass_freeze_cluster:X  → заморозить кластер X (определён ниже)
# =============================================================================

# -----------------------------------------------------------------------------
# Настройки mass_freeze_top
# -----------------------------------------------------------------------------
# Сколько процессов замораживать в режиме mass_freeze_top
top_cpu:
  count: 5

# -----------------------------------------------------------------------------
# Кластеры процессов
# -----------------------------------------------------------------------------
# Кластер — логическая группа процессов.
# Процесс попадает в кластер, если его имя СОДЕРЖИТ одно из слов.
#
# Использование в config.yaml:
#   actions:
#     - mass_freeze_cluster:website
#
# Четвёртый режим: пользователь вручную определяет какие процессы
# принадлежат какому кластеру.
clusters:
  # Типичный LAMP/LEMP stack
  website:
    - nginx
    - php-fpm
    - mysqld
    - apache2

  # Node.js stack
  crm:
    - node
    - redis-server
    - postgres

  # Python API
  api:
    - gunicorn
    - celery
    - rabbitmq

  # Docker
  docker:
    - dockerd
    - containerd
    - docker-proxy

  # Добавьте свои кластеры:
  # my_app:
  #   - my-service
  #   - my-worker

# -----------------------------------------------------------------------------
# Whitelist — НИКОГДА не замораживаем
# -----------------------------------------------------------------------------
# Применяется ко ВСЕМ режимам (mass_freeze, mass_freeze_top, cluster).
#
# Помимо этого списка, ВСЕГДА защищены (hardcoded):
#   - Все root-процессы
#   - sshd (критично для удалённого доступа!)
#   - panicmode (сам себя)
#   - systemd, init, journald
whitelist:
  # Мониторинг (чтобы видеть что происходит)
  - prometheus
  - node_exporter
  - grafana-server
  - telegraf

  # Логирование (чтобы не потерять логи инцидента)
  - rsyslogd
  - fluentd

  # Добавьте свои критичные процессы:
  # - payment-processor
  # - backup-daemon

# =============================================================================
# Восстановление после заморозки
# =============================================================================
#
# ⚠️  Замороженные процессы НЕ размораживаются автоматически!
#
# 1. Подключитесь по SSH (sshd защищён, он работает)
# 2. Разморозьте:
#      sudo panicmode-unfreeze            # всё
#      sudo panicmode-unfreeze website    # конкретный кластер
#    или вручную:
#      sudo kill -CONT <pid>
#
# 3. Проверьте состояние:
#      top
#      ps aux | grep T    # процессы в состоянии "stopped"
# =============================================================================